<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BGMSyncVisualizer.UI"
        xmlns:local="using:BGMSyncVisualizer.UI"
        x:Class="BGMSyncVisualizer.UI.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="BPM Sync Visualizer"
        Width="800"
        Height="500"
        MinWidth="500"
        MinHeight="350"
        WindowStartupLocation="CenterScreen">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="10">
        
        <!-- File Import Area -->
        <Border Grid.Row="0" 
                Background="LightGray" 
                BorderBrush="DarkGray" 
                BorderThickness="2" 
                CornerRadius="5"
                Height="100"
                Margin="0,0,0,10"
                DragDrop.AllowDrop="True">
            <Grid>
                <TextBlock Text="mp3またはwavファイルをここにドロップ"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontSize="14"
                           Foreground="DarkGray"/>
            </Grid>
        </Border>

        <!-- Waveform Display -->
        <Grid Grid.Row="1" RowDefinitions="*,Auto" Margin="0,0,0,10">
            <local:WaveformControl Grid.Row="0" 
                                   DataContext="{Binding WaveformViewModel}"
                                   Height="200"
                                   IsEnabled="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).CanSeek}"/>
            
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                <TextBlock Text="クリックで開始ポイント設定 | " FontSize="10" Foreground="Gray"/>
                <TextBlock Text="赤線: 開始ポイント | " FontSize="10" Foreground="Red"/>
                <TextBlock Text="黄線: 現在位置" FontSize="10" Foreground="Gold"/>
            </StackPanel>
        </Grid>

        <!-- Controls -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*,*,Auto" Margin="0,0,0,10">
            
            <!-- Play Button -->
            <Button Grid.Column="0"
                    Name="PlayButton"
                    Content="再生"
                    Height="35"
                    Command="{Binding PlayCommand}"
                    Margin="0,0,5,0"/>

            <!-- Stop Button -->
            <Button Grid.Column="1"
                    Name="StopButton"
                    Content="停止"
                    Height="35"
                    Command="{Binding StopCommand}"
                    Margin="5,0,10,0"/>

            <!-- Loop Checkbox -->
            <StackPanel Grid.Column="2" Orientation="Vertical" VerticalAlignment="Center">
                <CheckBox Content="ループ再生"
                          IsChecked="{Binding Loop}"
                          IsEnabled="{Binding !IsPlaying}"/>
            </StackPanel>

            <!-- Start Time Display -->
            <StackPanel Grid.Column="3" Orientation="Vertical" VerticalAlignment="Center">
                <TextBlock Text="開始時間:" Margin="0,0,5,0"/>
                <TextBlock Text="{Binding CurrentStartText}" 
                           FontSize="12" 
                           VerticalAlignment="Center"
                           Background="LightGray"
                           Padding="5"/>
            </StackPanel>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" 
                Background="LightGray" 
                BorderBrush="Gray" 
                BorderThickness="1" 
                CornerRadius="3"
                Padding="5">
            <TextBlock Text="{Binding StatusMessage}" 
                       Foreground="{Binding StatusMessageColor}"
                       FontSize="12"/>
        </Border>
    </Grid>
</Window>